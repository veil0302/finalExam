<!DOCTYPE html>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/layout}">

<head>
    <meta charset="UTF-8">
    <title>ë„ì„œ ê²€ìƒ‰</title>
    <style>
        .book-card {
            border: 1px solid #ddd;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 16px;
            display: flex;
            gap: 16px;
            background: #fafafa;
        }

        .book-card img {
            border-radius: 8px;
        }
    </style>
</head>


<div layout:fragment="content" class="container my-5">

    <!-- í˜ì´ì§€ ì œëª© -->
    <h1 class="text-center mb-4">ğŸ“š ë„¤ì´ë²„ ë„ì„œ ê²€ìƒ‰</h1>

    <!-- ê²€ìƒ‰ UI -->
    <div class="input-group mb-4">
        <input type="text"
               id="searchInput"
               class="form-control"
               placeholder="ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”">

        <button class="btn btn-primary" onclick="searchBook()">ê²€ìƒ‰</button>
    </div>

    <!-- ê²€ìƒ‰ ê²°ê³¼ ì¶œë ¥ -->
    <div id="result"></div>

</div>
<th:block layout:fragment="script">
    <script src="https://code.jquery.com/jquery-3.4.1.js"></script>
    <script type="text/javascript">

        async function searchBook() {
      const query = document.getElementById("searchInput").value;

      const res = await fetch(`/api/books/search?query=${encodeURIComponent(query)}`);
      const data = await res.json();   // JSON ê°ì²´ë¡œ íŒŒì‹±

      const items = data.items; // ì±… ëª©ë¡ ë°°ì—´

      let html = "";

      items.forEach(book => {
          html += `
              <div class="book-card">
                  <img src="${book.image}" width="80" alt="ì±… ì´ë¯¸ì§€">
                  <div>
                      <h4>${book.title}</h4>
                      <p><strong>ì €ì:</strong> ${book.author}</p>
                      <p><strong>ì¶œíŒì‚¬:</strong> ${book.publisher}</p>
                      <p><strong>ì¶œê°„ì¼:</strong> ${book.pubdate}</p>
                      <a href="${book.link}" target="_blank">ìƒì„¸ë³´ê¸°</a>
                  </div>
              </div>
          `;
      });

      document.getElementById("result").innerHTML = html;
  }


    </script>
</th:block>

</html>
