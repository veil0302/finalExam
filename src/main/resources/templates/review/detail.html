<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      layout:decorate="~{layouts/layout}">

<div layout:fragment="content" class="container my-5 review-article">

    <!-- =========================
         ğŸ“ ê²Œì‹œê¸€ ì œëª©
    ========================= -->
    <h1 class="article-title"
        th:text="${review.reviewTitle}">
        ë¦¬ë·° ì œëª©
    </h1>

    <!-- =========================
         ğŸ“• ì±… ì •ë³´ (í™•ëŒ€ ë²„ì „)
    ========================= -->
    <div class="article-book-lg"
         th:if="${review.bookTitle != null}">

        <img th:src="${review.bookImageUrl}" alt="ì±… í‘œì§€">

        <div class="book-meta-lg">
            <h3 th:text="${review.bookTitle}">ì±… ì œëª©</h3>
            <p th:text="${review.bookAuthor}">ì €ì</p>
        </div>
    </div>
    <!-- =========================
         ğŸ“„ ë³¸ë¬¸ (í¬ê²Œ)
    ========================= -->
    <div class="article-body">
        <p th:text="${review.reviewContent}"></p>
    </div>

    <!-- ì‘ì„±ì / ë‚ ì§œ -->
    <div class="article-footer">
        <span th:text="${review.author.username}"></span>
        Â·
        <span th:text="${#temporals.format(review.created,'yyyy-MM-dd HH:mm')}"></span>
    </div>

    <!-- ìˆ˜ì • / ì‚­ì œ -->
    <div class="article-actions"
         sec:authorize="isAuthenticated()"
         th:if="${review.author != null and #authentication.getPrincipal().username == review.author.username}">
        <a th:href="@{|/review/modify/${review.id}|}"
           class="btn btn-sm btn-outline-primary">ìˆ˜ì •</a>
        <a href="javascript:void(0)"
           th:data-uri="@{|/review/delete/${review.id}|}"
           class="delete btn btn-sm btn-outline-danger">ì‚­ì œ</a>
    </div>



    <div class="article-divider">
        <hr>
    </div>
    <h5 class="comment-title"
        th:text="|ëŒ“ê¸€ ${#lists.size(review.reviewCommentList)}|"></h5>

    <div class="comment-item"
         th:each="comment : ${review.reviewCommentList}">

        <div class="comment-content"
             th:text="${comment.content}"></div>

        <div class="comment-meta">
            <span th:text="${comment.author.username}"></span>
            Â·
            <span th:text="${#temporals.format(comment.created,'yyyy-MM-dd HH:mm')}"></span>
        </div>

        <div class="comment-actions"
             sec:authorize="isAuthenticated()"
             th:if="${comment.author != null and #authentication.getPrincipal().username == comment.author.username}">
            <a th:href="@{|/reviewComment/modify/${comment.id}|}">ìˆ˜ì •</a>
            <a href="javascript:void(0)"
               th:data-uri="@{|/reviewComment/delete/${comment.id}|}"
               class="delete">ì‚­ì œ</a>
        </div>
    </div>

    <!-- =========================
         âœ ëŒ“ê¸€ ì‘ì„± (ì‘ê²Œ)
    ========================= -->
    <form class="comment-form"
          th:action="@{|/reviewComment/create/${review.id}|}"
          method="post">

        <textarea sec:authorize="isAnonymous()"
                  disabled
                  rows="3"
                  placeholder="ë¡œê·¸ì¸ í›„ ëŒ“ê¸€ì„ ì‘ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤."></textarea>

        <textarea sec:authorize="isAuthenticated()"
                  name="content"
                  rows="3"
                  placeholder="ëŒ“ê¸€ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>

        <button type="submit" class="btn btn-primary btn-sm">
            ë“±ë¡
        </button>
    </form>

</div>

<th:block layout:fragment="script">
    <script>
        $(function () {
            $(".delete").click(function () {
                if (confirm("ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
                    window.location.href = $(this).data("uri");
                }
            });
        });
    </script>
</th:block>

</html>
