<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/layout}">

<head>
    <style>
        /* -----------------------------
           테이블 디자인
        ----------------------------- */
        .review-table img {
            width: 70px;
            height: 90px;
            object-fit: cover;
            border-radius: 6px;
            box-shadow: 0 2px 4px rgba(0,0,0,.15);
        }

        .book-box {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            width: 120px;
        }

        .book-title {
            font-size: 0.9rem;
            font-weight: 600;
            margin-top: 6px;
            color: #333;
        }

        .book-author {
            font-size: 0.8rem;
            color: #666;
        }

        /* 테이블 행 hover 효과 */
        .review-table tbody tr:hover {
            background: #f8f9fa;
            cursor: pointer;
        }

        /* 제목 + 댓글 배지 정리 */
        .review-link {
            font-weight: 600;
        }

        .comment-badge {
            margin-left: 6px;
        }
    </style>
</head>


<div layout:fragment="content" class="container my-3">
    <h1 class="text-center mb-5 fw-bold"><i class="bi bi-bookmark-fill"></i>
        도서 감상평 게시판</h1>

    <div>
        <a th:href="@{/review/create}" class="btn btn-primary mt-3">리뷰 작성</a>
    </div>

    <table class="table table-hover align-middle review-table">
        <thead class="table-dark">
        <tr>
            <th style="width: 80px;">번호</th>
            <th style="width: 150px; text-align:center;">도서 정보</th>
            <th>리뷰 제목</th>
            <th style="width: 140px;">작성자</th>
            <th style="width: 170px;">작성일</th>
        </tr>
        </thead>

        <tbody>
        <tr th:each="review, loop : ${paging}">
            <!-- 번호 -->
            <td th:text="${paging.totalElements - loop.index - (paging.number * paging.size)}"></td>

            <td>
                <div class="book-box mx-auto">

                    <!-- 이미지 -->
                    <img th:src="${review.bookImageUrl}" alt="책 이미지">

                    <!-- 책 제목 -->
                    <div class="book-title" th:text="${review.bookTitle}">책 제목</div>

                    <!-- 저자 -->
                    <div class="book-author" th:text="${review.bookAuthor}">저자명</div>

                </div>
            </td>

            <!-- 리뷰 제목 -->
            <td>
                <a class="review-link"
                   th:href="@{|/review/detail/${review.id}|}"
                   th:text="${review.reviewTitle}"></a>

                <!-- 댓글 개수 -->
                <span class="badge bg-primary comment-badge"
                      th:if="${#lists.size(review.reviewCommentList)} > 0"
                      th:text="${#lists.size(review.reviewCommentList)}"></span>
            </td>

            <!-- 작성자 -->
            <td th:text="${review.author.username}"></td>

            <!-- 작성일 -->
            <td th:text="${#temporals.format(review.created, 'yyyy-MM-dd HH:mm:ss')}"></td>
        </tr>
        </tbody>
    </table>


    <!-- =============================
         페이징 UI
    ============================== -->
    <div th:if="${!paging.isEmpty()}">
        <th:block th:with="startPage=${(paging.number/10) * 10},
                           endPage=(${(paging.totalPages == 0) ? 1 : (startPage + 9 < paging.totalPages ? startPage + 9 : paging.totalPages - 1)})">

            <ul class="pagination justify-content-center">

                <li class="page-item" th:classappend="${paging.number == 0} ? 'disabled'">
                    <a class="page-link" href="javascript:void(0)" th:data-page="0">처음</a>
                </li>

                <li class="page-item" th:classappend="${!paging.hasPrevious} ? 'disabled'">
                    <a class="page-link" href="javascript:void(0)" th:data-page="${paging.number-1}">이전</a>
                </li>

                <li class="page-item"
                    th:each="page : ${#numbers.sequence(startPage, endPage)}"
                    th:classappend="${page == paging.number} ? 'active'">
                    <a class="page-link" href="javascript:void(0)"
                       th:data-page="${page}"
                       th:text="${page + 1}"></a>
                </li>

                <li class="page-item" th:classappend="${!paging.hasNext} ? 'disabled'">
                    <a class="page-link" href="javascript:void(0)" th:data-page="${paging.number+1}">다음</a>
                </li>

                <li class="page-item" th:classappend="${paging.number == paging.totalPages-1} ? 'disabled'">
                    <a class="page-link" href="javascript:void(0)" th:data-page="${paging.totalPages-1}">마지막</a>
                </li>
            </ul>

        </th:block>
    </div>

    <form th:action="@{/review/list}" method="get" id="searchForm">
        <input type="hidden" id="page" name="page" th:value="${paging.number}">
    </form>
</div>


<!-- =============================
     페이징 이동 스크립트
============================== -->
<script layout:fragment="script">
    const pageElements = document.getElementsByClassName("page-link");
    Array.from(pageElements).forEach(el => {
        el.addEventListener("click", function () {
            document.getElementById("page").value = this.dataset.page;
            document.getElementById("searchForm").submit();
        });
    });
</script>

</html>
