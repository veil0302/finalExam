<!DOCTYPE html>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/layout}">

<head>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

    <!-- mypage ì „ìš© css -->
    <link rel="stylesheet" th:href="@{/css/mypage.css}">

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

</head>

<body>
<div layout:fragment="content" class="container my-5">


    <h2 class="fw-bold mb-4"><i class="bi bi-book"></i>
        ë‚´ ì„œì¬</h2>

    <!-- ê·¸ë˜í”„ ì˜ì—­ -->
    <div class="row g-4">

        <div class="col-lg-6">

            <div class="card-dark mb-4">
                <h5 class="section-title"><i class="bi bi-bar-chart-line"></i>
                    ì˜¬í•´ ì½ì€ ì±…</h5>
                <canvas id="yearChart"></canvas>
            </div>

            <div class="card-dark">
                <h5 class="section-title"><i class="bi bi-graph-up"></i>ì‘ë…„ ë…ì„œëŸ‰ ë¹„êµ</h5>
                <canvas id="compareChart"></canvas>
            </div>
        </div>

        <div class="col-lg-6">
            <div class="card-dark h-100">
                <h5 class="section-title"><i class="bi bi-pie-chart"></i>
                    ì¹´í…Œê³ ë¦¬ë³„ ë…ì„œëŸ‰</h5>
                <canvas id="categoryChart"></canvas>
            </div>
        </div>
    </div>
    <br>


    <div class="row g-4">

        <!-- ì½ì„ ì˜ˆì • -->
        <div class="col-md-4">
            <div class="book-card" onclick="location.href='/to-read'">
                <h5 class="fw-bold">ğŸ“• ì½ì„ ì˜ˆì •</h5>
                <p class="category-label">
                    ì´ <span th:text="${#lists.size(toReadList)}"></span>ê¶Œ
                </p></div>
        </div>

        <!-- ì½ëŠ” ì¤‘ -->
        <div class="col-md-4">
            <div class="book-card" onclick="location.href='/reading'">
                <h5 class="fw-bold">ğŸ“˜ ì½ëŠ” ì¤‘</h5>
                <p class="category-label">
                    ì´ <span th:text="${#lists.size(readingList)}"></span>ê¶Œ
                </p>
            </div>
        </div>

        <div class="col-md-4">
            <div class="book-card" onclick="location.href='/completed'">
                <h5 class="fw-bold">ğŸ“— ì™„ë…</h5>
                <p class="category-label">
                    ì´ <span th:text="${#lists.size(completedList)}"></span>ê¶Œ
                </p>
            </div>
        </div>
    </div>
</div>
<!---->
<div id="thisYearCounts"
     th:data-values="${#strings.arrayJoin(thisYearCounts, ',')}">
</div>
<div id="lastYearCounts"
     th:data-values="${#strings.arrayJoin(lastYearCounts, ',')}">
</div>

<!-- Chart.js ìŠ¤í¬ë¦½íŠ¸ -->

<th:block layout:fragment="script">
    <script th:inline="javascript">
        const thisYearCounts = [[${thisYearCounts}]];
        const lastYearCounts = [[${lastYearCounts}]];

    console.log(thisYearCounts);
    console.log(lastYearCounts);

    new Chart(document.getElementById("yearChart"), {
        type: "bar",
        data: {
            labels: ["1ì›”","2ì›”","3ì›”","4ì›”","5ì›”","6ì›”",
                     "7ì›”","8ì›”","9ì›”","10ì›”","11ì›”","12ì›”"],
            datasets: [{
                label: "ì™„ë…í•œ ì±… ìˆ˜",
                data: thisYearCounts,
                backgroundColor: "#6c63ff"
            }]
        }
    });


            // í‰ê·  ë…ì„œëŸ‰ vs ë‚˜ì˜ ë…ì„œëŸ‰ (LINE CHART)
            new Chart(document.getElementById("compareChart"), {
            type: "line",
            data: {
            labels: ["1ì›”","2ì›”","3ì›”","4ì›”","5ì›”","6ì›”",
                     "7ì›”","8ì›”","9ì›”","10ì›”","11ì›”","12ì›”"],
            datasets: [
            {
            label: [[${thisYear}]] + "ë…„",
            data: thisYearCounts,
            borderColor: "#6c63ff",
            backgroundColor: "rgba(108,99,255,0.3)",
            borderWidth: 2,
            tension: 0.3
            },
            {
            label: [[${lastYear}]] + "ë…„",
            data: lastYearCounts,
            borderColor: "#f38b4a",
            backgroundColor: "rgba(243,139,74,0.3)",
            borderWidth: 2,
            tension: 0.3
            }
            ]
            },
            options: {
            scales: {
            y: { ticks: { color: "#fff" } },
            x: { ticks: { color: "#fff" } }
            },
            plugins: { legend: { labels: { color: "#fff" } } }
            }
            });


            // ì¹´í…Œê³ ë¦¬ë³„ ë…ì„œëŸ‰ (DONUT)
            new Chart(document.getElementById("categoryChart"), {
            type: "doughnut",
            data: {
            labels: ["ë¬¸í•™", "ì¸ë¬¸", "ê²½ì œ", "ìê¸°ê³„ë°œ"],
            datasets: [{
            data: [5, 3, 2, 4],
            backgroundColor: ["#6c63ff", "#f38b4a", "#4ac0c0", "#ffcd56"]
            }]
            }
            });
    </script>
</th:block>
</body>

</html>